name: Get Changed Folder

on:
  push:
    branches:
      - ItzhakBokris/changes-script

jobs:
  get_changed_folder:
    runs-on: ubuntu-latest

    steps:
      - name: Check out code
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
          ref: ItzhakBokris/changes-script

      - name: Find changed jsons
        id: find_changed_jsons
        run: |
          # Use git to get the list of changed files
          changed_files=$(git diff --name-only ${{ github.event.before }} ${{ github.sha }})

          # Initialize an empty array to store the changed network jsons
          changed_jsons=()
  
          # Loop through the changed files to fetch the content
          for file in $changed_files; do
            # Use the file command to check the MIME type
            mime_type=$(file -b --mime-type "$file")
  
            # Check if the MIME type is JSON
            if [[ ! "$mime_type" == "application/json" ]]; then
              continue
            fi
          
            # Read the content of the file
            file_content=$(cat "$file")
            echo $file_content

            changed_jsons+=("$file_content")
          done
          
          echo $changed_jsons
          
          # Set the output variable with the list of changed jsons
          echo "::set-output name=changed_jsons::${changed_jsons[*]}"

      - name: Use the changed jsons
        run: |
#          # Access the changed folders from the previous step's output
#          changed_folders="${{ steps.find_changed_folder.outputs.changed_folders }}"
#
#          # Make an API requests with the extracted folders as query parameters
#          for folder in $changed_folders; do
#            seq 1 200 | xargs -n1 -P10 curl -X GET "https://savenetworkrequest-zbrmx4rjia-uc.a.run.app?dir=$folder" --connect-timeout 420
#          done
